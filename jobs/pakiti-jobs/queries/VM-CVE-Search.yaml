- defaultTab: output
  description: A Specific CVE Search that will return Machine Details
  executionEnabled: true
  group: Pakiti-Jobs/Queries
  id: 50551aa5-5dd4-4697-bafe-ca9ab93da174
  loglevel: INFO
  loglimit: 100MB
  loglimitAction: halt
  loglimitStatus: failed
  name: VM-CVE-Search
  nodeFilterEditable: false
  options:
  - description: CVE Number - only the year and number please - see default value
    label: CVE Name
    name: CVEName
    required: true
    value: 2017-15906
  - description: Email address to send report to
    label: Email Address
    name: EmailAddress
    required: true
    value: cloud-support@gridpp.rl.ac.uk
  retry: '0'
  scheduleEnabled: true
  sequence:
    commands:
    - script: "#!/bin/bash\n\nDATE=\"\"\n\nif [[ ! -e \"reports\" ]]; then\n    echo\
        \ \"No Reports Directory Found - Creating...\"\n    mkdir \"reports\"\nfi\
        \    \n\nDATE=$(date +%Y%m%d-%H%M)\nMACHINES=()\n\ntouch reports/${DATE}-CVE-@option.CVEName@.txt\n\
        \necho \"VMs affected by CVE-@option.CVEName@\" > reports/${DATE}-CVE-@option.CVEName@.txt\n\
        \nwhile IFS= read -r line; do\n    MACHINES+=( \"$line\" )\ndone < <( grep\
        \ -nl CVE:@option.CVEName@ collated/machine_files/* | cut -d \"/\" -f3 | cut\
        \ -d \".\" -f1 )\n\nfor x in \"${MACHINES[@]}\"; do\n    echo Machine ID:\
        \ $(grep $x collated/machine_files/${x}.txt | cut -d \":\" -f2) >> reports/${DATE}-CVE-@option.CVEName@.txt\n\
        \    echo + Machine Name: $(grep machine_name collated/machine_files/${x}.txt\
        \ | cut -d \":\" -f2) >> reports/${DATE}-CVE-@option.CVEName@.txt\n    echo\
        \ + Openstack Username: $(grep user_name collated/machine_files/${x}.txt |\
        \ cut -d \":\" -f2) >> reports/${DATE}-CVE-@option.CVEName@.txt\n    echo\
        \ + User Email Address: $(grep email: collated/machine_files/${x}.txt | cut\
        \ -d \":\" -f2) >> reports/${DATE}-CVE-@option.CVEName@.txt\ndone\n\necho\
        \ '' | mailx -s 'CVE search result for CVE-@option.CVEName@' -a reports/${DATE}-CVE-@option.CVEName@.txt\
        \ @option.EmailAddress@"
    keepgoing: false
    strategy: node-first
  timeout: 10m
  uuid: 50551aa5-5dd4-4697-bafe-ca9ab93da174
