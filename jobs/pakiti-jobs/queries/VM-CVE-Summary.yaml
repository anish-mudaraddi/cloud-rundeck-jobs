- defaultTab: output
  description: A CVE Number Summary of all VMs reporting
  executionEnabled: true
  group: Pakiti-Jobs/Queries
  id: 1a836b36-469e-4cfd-8b86-8436969fe5aa
  loglevel: INFO
  loglimit: 100MB
  loglimitAction: halt
  loglimitStatus: failed
  name: VM-CVE-Summary
  nodeFilterEditable: false
  options:
  - description: Email address to send report to
    label: Email Address
    name: EmailAddress
    required: true
    value: cloud-support@gridpp.rl.ac.uk
  retry: '0'
  scheduleEnabled: true
  sequence:
    commands:
    - script: "#!/bin/bash\n\nDATE=\"\"\nCVES=()\n\nif [[ ! -e \"reports\" ]]; then\n\
        \    echo \"No Reports Directory Found - Creating...\"\n    mkdir \"reports\"\
        \nfi    \n\nDATE=$(date +%Y%m%d-%H%M)\n\ntouch reports/${DATE}-CVE-summary.txt\n\
        \necho \"Kernel Version Count for all Openstack VMs\" > reports/${DATE}-CVE-summary.txt\n\
        \nwhile IFS= read -r line; do\n    CVES+=( \"$line\" )\ndone < <( grep CVE:\
        \ collated/machine_files/* | cut -d \":\" -f3 | sort --unique )\n\nfor x in\
        \ \"${CVES[@]}\"; do\n    echo CVE: $x >> reports/${DATE}-CVE-summary.txt\n\
        \    echo + Number of VMs: $(grep -nl $x collated/machine_files/* | wc -l)\
        \ >> reports/${DATE}-CVE-summary.txt\ndone\n\necho '' | mailx -s 'CVE summary\
        \ for all openstack VMs reporting to Pakiti' -a reports/${DATE}-CVE-summary.txt\
        \ @option.EmailAddress@"
    keepgoing: false
    strategy: node-first
  timeout: 10m
  uuid: 1a836b36-469e-4cfd-8b86-8436969fe5aa
